<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: #1f1f2e;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 2rem;
            min-height: 100vh;
        }

        h1 {
            color: #ff4c4c;
            margin-bottom: 2rem;
            text-align: center;
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 700px;
        }

        .user-card {
            background-color: #2c2c3e;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

            .user-card h3 {
                margin: 0 0 0.5rem;
            }

            .user-card p {
                margin: 0.5rem 0;
                text-align: center;
            }

            .user-card button {
                background-color: #ff4c4c;
                color: #fff;
                border: none;
                padding: 0.5rem 1rem;
                border-radius: 6px;
                cursor: pointer;
                font-weight: bold;
                margin-top: 0.5rem;
            }

                .user-card button:hover {
                    background-color: #e03e3e;
                }

        .mods {
            margin-top: 1rem;
            width: 100%;
            text-align: left;
        }

            .mods p {
                margin: 0.3rem 0;
            }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #2c2c3e;
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

            .modal-content input, .modal-content textarea {
                width: 100%;
                margin-bottom: 1rem;
                padding: 0.5rem;
                border-radius: 6px;
                border: none;
                font-size: 1rem;
            }

            .modal-content button {
                width: 100%;
                padding: 0.75rem;
                background-color: #ff4c4c;
                color: #fff;
                border: none;
                border-radius: 8px;
                font-weight: bold;
            }

                .modal-content button:hover {
                    background-color: #e03e3e;
                }
    </style>
</head>
<body>
    <h1>Admin Panel</h1>
    <div id="userList" class="user-list"></div>

    <div id="banModal" class="modal">
        <div class="modal-content">
            <h2>Ban User</h2>
            <textarea id="banReason" placeholder="Enter reason..." rows="3"></textarea>
            <input type="date" id="banDate">
            <button id="confirmBan">Confirm Ban</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBpK_RPB-mr_EuaD594bEdS5DTqKPVzflg",
            authDomain: "minecraftaddoncreator.firebaseapp.com",
            projectId: "minecraftaddoncreator",
            storageBucket: "minecraftaddoncreator.appspot.com",
            messagingSenderId: "575674413085",
            appId: "1:575674413085:web:7b52ae5d59c418002816f4"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const currentUsername = localStorage.getItem("username");
        const userList = document.getElementById("userList");

        db.collection("users").doc(currentUsername).get().then(doc => {
            const userData = doc.data();
            if (!doc.exists || !userData || userData.admin !== true) {
                document.body.innerHTML = "<h1>Access Denied</h1><p>You are not authorized to view this page.</p>";
                return;
            }

            db.collection("users").get().then(snapshot => {
                snapshot.forEach(userDoc => {
                    const username = userDoc.id;
                    const data = userDoc.data();

                    db.collection("users").doc(username).collection("ban").doc("info").get().then(banDoc => {
                        const isBanned = banDoc.exists;

                        const card = document.createElement("div");
                        card.className = "user-card";
                        card.innerHTML = `
                  <h3>${username}</h3>
                  <p>User ID: ${data.userId || "Unknown"}</p>
                  <p>Status: ${isBanned ? "Banned" : "Active"}</p>
                  <button onclick="${isBanned ? `unbanUser('${username}', this)` : `openBanModal('${username}')`}">
                    ${isBanned ? "Unban User" : "Ban User"}
                  </button>
                  <div class="mods" id="mods-${username}"><em>Loading mods...</em></div>
                `;
                        userList.appendChild(card);

                        // Load MODS
                        db.collection("users").doc(username).collection("MODS").get().then(modsSnapshot => {
                            const modsContainer = document.getElementById(`mods-${username}`);
                            if (modsSnapshot.empty) {
                                modsContainer.innerHTML = `<p><em>No mods found.</em></p>`;
                            } else {
                                modsContainer.innerHTML = `<strong>Mods:</strong>`;
                                modsSnapshot.forEach(modDoc => {
                                    const mod = modDoc.data();
                                    const modElement = document.createElement("div");
                                    modElement.innerHTML = `
                        <p><strong>${mod.name || "Unnamed Mod"}</strong><br>
                        ${mod.description || "No description"}</p>
                      `;
                                    modsContainer.appendChild(modElement);
                                });
                            }
                        });
                    });
                });
            });
        });

        let selectedUser = null;

        function openBanModal(username) {
            selectedUser = username;
            document.getElementById("banModal").style.display = "flex";
        }

        document.getElementById("confirmBan").onclick = () => {
            const reason = document.getElementById("banReason").value.trim();
            const date = document.getElementById("banDate").value;

            if (!reason || !date) return;

            db.collection("users").doc(selectedUser).collection("ban").doc("info").set({
                reason: reason,
                duration: "Permanent",
                dateIssued: date
            }).then(() => {
                document.getElementById("banModal").style.display = "none";
                document.getElementById("banReason").value = "";
                document.getElementById("banDate").value = "";
                location.reload();
            });
        };

        console.log(`
      _______      _________      _____       ______     _
     / _____ \\    |____ ____|    / ___ \\     | ____ \\   | |
    / /     \\_\\       | |       / /   \\ \\    | |   \\ \\  | |
    | |               | |      / /     \\ \\   | |   | |  | |
    \\ \\______         | |      | |     | |   | |___/ /  | |
     \\______ \\        | |      | |     | |   |  ____/   | |
            \\ \\       | |      | |     | |   | |        | |
     _      | |       | |      \\ \\     / /   | |        |_|
    \\ \\_____/ /       | |       \\ \\___/ /    | |         _
     \\_______/        |_|        \\_____/     |_|        |_|

     Keep your account safe! Do not send any information from
     here to anyone or paste any text here.

     If someone is asking you to copy or paste text here then
     you're giving someone access to your account.
`);


        function unbanUser(username, button) {
            db.collection("users").doc(username).collection("ban").doc("info").delete().then(() => {
                button.textContent = "Ban User";
                button.setAttribute("onclick", `openBanModal('${username}')`);
                button.parentElement.querySelector("p:nth-child(3)").textContent = "Status: Active";
            });
        }
    </script>
</body>
</html>
